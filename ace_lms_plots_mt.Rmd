---
title: "ace_lms_plots_mt"
author: "Monica Thieu"
date: "August 12, 2016"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyr)
library(plyr)
library(dplyr)
library(outliers)
```


```{r helper functions}
load(file = "~/Dropbox/aceR/seacrest_data/clean_data.RData")

brt_append = function(df) {
  df %>%
    select(pid, time, gender:intervention_type, everything()) %>%
    select(-bid, -file) %>%
    left_join(
      select(brt,
             pid,
             brt_rt_mean.overall = rt_mean.overall,
             brt_rt_median.overall = rt_median.overall,
             brt_rt_mean.right = rt_mean.right,
             brt_rt_median.right = rt_median.right,
             brt_rt_mean.left = rt_mean.left,
             brt_rt_median.left = rt_median.left),
      by = c("pid" = "pid")) %>%
    select(pid:intervention_type, starts_with("brt"), everything())
}

clean_grade_gender = function(df) {
  df %>%
    mutate(grade = as.factor(grade),
           gender = as.factor(gender),
           grade_num = NA) %>%
    within({
      grade_num[grade == "3rd Grade"] = 3
      grade_num[grade == "5th Grade"] = 5
      grade_num[grade == "7th Grade"] = 7
    }) %>%
    mutate(grade_num = grade_num - 3) %>%
    within({
      contrasts(gender) = c(-1, 1)
    })
}
```

#BRT
```{r}
# it would seem that all the outcome variables of interest begin with rt_
# now I am extremely concerned about multiple comparisons... I'll do an FDR using n = n_modules * n_varspermodule

brt_raw <- proc_demo$BRT
```

##outlier testing
```{r}
brt_raw %>%
  filter(grade == "3rd Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE)
  )
```

```{r}
brt_raw %>%
  filter(grade == "5th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE)
  )
# b016 is high side (slow RT) outlier by Grubbs' two sided test (p = .020)
# no other outliers when b016 excluded
```

```{r}
brt_raw %>%
  filter(grade == "7th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE)
  )
```

```{r brt cleaning outliers}
brt <- brt_raw %>%
  filter(pid != "ADMIN-UCSF-b016") %>%
  clean_grade_gender()
```

##regressions
###grade x gender (same as all the other ones, for reference)
```{r}
brt %>%
  with(summary(lm(rt_median.overall ~ grade_num * gender)))
```

#Boxed
```{r}
box_raw <- proc_demo$BOXED
box <- box_raw %>%
  brt_append() %>%
  clean_grade_gender()
```

##outlier testing
```{r}
box %>%
  filter(grade == "3rd Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
box %>%
  filter(grade == "5th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
box %>%
  filter(grade == "7th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

##regressions
###median overall RT
```{r}
box %>%
  with(summary(lm(rt_median.overall ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###median overall cost of proc (?) on RT
```{r}
box %>%
  with(summary(lm(rt_median.proc_cost_median ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###median overall cost of distractor # on RT
```{r}
box %>%
  with(summary(lm(rt_median.dist_cost_median ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###median overall cost of conjunction on RT
```{r}
box %>%
  with(summary(lm(rt_median.conj_cost ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###median overall cost of feature # on RT
```{r}
box %>%
  with(summary(lm(rt_median.feat_cost ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

#Flanker
```{r}
flank_raw <- proc_demo$FLANKER
flank <- flank_raw %>%
  brt_append() %>%
  clean_grade_gender()
```

##outlier testing
```{r}
flank %>%
  filter(grade == "3rd Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
flank %>%
  filter(grade == "5th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
flank %>%
  filter(grade == "7th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

##regressions
###median overall RT
```{r}
flank %>%
  with(summary(lm(rt_median.overall ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###median overall cost on RT
```{r}
# for this and subsequent modules, it seems that outlier testing should be done on RT, but cost should be used as the primary outcome var of interest when cost is available?
flank %>%
  with(summary(lm(rt_median.cost ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

#SAAT
```{r}
saat_raw <- proc_demo$SAAT
saat <- saat_raw %>%
  brt_append() %>%
  clean_grade_gender()
```

##outlier testing
```{r}
saat %>%
  filter(grade == "3rd Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
saat %>%
  filter(grade == "5th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
saat %>%
  filter(grade == "7th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

##regressions
###median overall RT
```{r}
saat %>%
  with(summary(lm(rt_median.overall ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

#Spatial span
```{r}
span_raw <- proc_demo$SPATIALSPAN
span <- span_raw %>%
  brt_append() %>%
  clean_grade_gender()
```

##outlier testing
```{r}
span %>%
  filter(grade == "3rd Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
span %>%
  filter(grade == "5th Grade", !(pid %in% c("ADMIN-UCSF-b016", "ADMIN-UCSF-b023"))) %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
# b016 is an outlier here (RT too low aka too FAST) but since she is already excluded from BRT don't need to re-exclude her here
# when b016 excluded, b023 is an outlier (RT too high, aka too SLOW)
```

```{r}
span %>%
  filter(grade == "7th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r spatial span cleaning outliers}
span <- span %>%
  filter(!(pid %in% c("ADMIN-UCSF-b016", "ADMIN-UCSF-b023")))
```

##regressions
###median overall RT
```{r}
span %>%
  with(summary(lm(rt_median.overall ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###object count span
```{r}
# note here that we are NOT using RT as the outcome var! but we are using it for outlier testing
span %>%
  with(summary(lm(object_count_span.overall ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```


#Stroop task
```{r}
stroop_raw <- proc_demo$STROOP
stroop <- stroop_raw %>%
  brt_append() %>%
  clean_grade_gender()
```

##outlier testing
```{r}
stroop %>%
  filter(grade == "3rd Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
stroop %>%
  filter(grade == "5th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
stroop %>%
  filter(grade == "7th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

##regressions
###median overall RT
```{r}
stroop %>%
  with(summary(lm(rt_median.overall ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###median overall cost on RT
```{r}
stroop %>%
  with(summary(lm(rt_median.cost ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```


#Task switching
```{r}
switch_raw <- proc_demo$TASKSWITCH
switch <- switch_raw %>%
  brt_append() %>%
  clean_grade_gender()
```

##outlier testing
```{r}
switch %>%
  filter(grade == "3rd Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
switch %>%
  filter(grade == "5th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
# again b016 is an outlier (rt too LONG), she is not doing so hot
```

```{r}
switch %>%
  filter(grade == "7th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

##regressions
###median overall RT
```{r}
switch %>%
  with(summary(lm(rt_median.overall ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###median overall cost on RT
```{r}
switch %>%
  with(summary(lm(rt_median.cost ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

#TNT
```{r}
tnt_raw <- proc_demo$TNT
tnt <- tnt_raw %>%
  brt_append() %>%
  clean_grade_gender()
```

##outlier testing
```{r}
tnt %>%
  filter(grade == "3rd Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
tnt %>%
  filter(grade == "5th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

```{r}
tnt %>%
  filter(grade == "7th Grade") %>%
  with(
    grubbs.test(rt_median.overall, two.sided = TRUE))
```

##regressions
###median overall RT
```{r}
tnt %>%
  with(summary(lm(rt_median.overall ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```

###median overall cost on RT
```{r}
tnt %>%
  with(summary(lm(rt_median.cost ~ grade_num * gender + scale(brt_rt_median.overall, scale = F))))
```